К сожалению у меня нет большого опыта с Yii2 так что могу предложить оптимальные решения с привязкой к фреймворку.

По-текущему назвоню событий, например:
- customer_change_type
- outgoing_sms
- completed_task

не совсем понимаю зачем хранить название объекта в событии если для объекта есть отдельная колонка, но даже если это часть бизнес логики то структура названий желательно чтобы была согласованна, например:
- customer_change_type
- sms_outgoing
- task_completed

Заметил в history.sql такие объекты call_ytel, deal, lead, получается либо не хватает сущностей либо неправильно заполнено поле объекта.

Выделил абстрактный класс Contact  чтобы избежать дублирования кода в Fax, Call и Sms.

Не знаю есть ли такой механизм в Yii2, но в Symfony вместо добавления ручками названия классов в ObjectNameTrait использовал бы Service Tags (!tagged_iterator)

Чтобы избавится от двух мест со switch-ами по событиям, сделал классы с событиями и фабрику.

По нагрузке:
- Если это делается для возможности вести и в последующем просматривать лог, то лучше использовать логи и такой инструмент как Logstash например.
- Если История участвует в Бизнес логике, можно завести отдельную БД для нее(можно Mongo или ClickHouse) и поделить на таблицы например историю контактов(звонки, факс, смс) и остальной в зависимости что как наполняется.


# Тестовое задание компании Americor на должность «PHP developer»

Дана часть кода из проекта. Решение вашего задания мы нигде не сможем использовать, у нас эта проблема уже решена. Учтите, что проект и объем данных будут расти, количество типов событий и объектов увеличиваться. 150+ типов событий, рост около 2 типов событий в месяц. 30+ объектов.

**Вариант 1. Рефакторинг кода**

1. Импортируйте код в свой git-репозиторий (не делайте fork).
2. В отдельной ветке проведите рефакторинг вывода ленты истории и экспорта данных.
3. Сделайте pull request из ветки в master (вашего репозитория). В описании pull request:
    - Приведите список изменений.
    - Для каждого изменения опишите, для чего было сделано.
4. Пришлите нам ссылку на pull request.

**Вариант 2. Ревью кода**

1. Укажите места в коде которые требуют улучшений (ссылкой на код)
2. Опишите проблему, почему это проблема и как её нужно решить
3. Пришлите нам результаты в PDF файле.

**При рассмотрении решения хотим увидеть:**

1. Понимание ООП.
2. Умение применять паттерны проектирования.
3. Умение разделять код.
4. Понимание Yii 2.
5. Какие проблемы вы считаете первостепенными.
6. Насколько ваш подход будет удобен в поддержке и развитии.
7. Решение проблемы с экспортом в случае больших данных
